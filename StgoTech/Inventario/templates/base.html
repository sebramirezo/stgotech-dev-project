<!doctype html>
{% load static %}
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sistema de Inventario - Stgo Technik Gruppe</title>
    <link rel="shortcut icon" type="image/png" href="{% static 'img/iconostgo.webp' %}" >
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static '/css/style.css' %}"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    
    {% include 'navbar.html' %}
  </head>
  <body>
    <div class="">
        <button class="btn btn-warning m-2" type="button" onclick="history.back()" name="volver atrás" value="Volver atrás">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16">
                <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z"/>
            </svg>
            Volver átras
        </button>
        <!-- <input class="btn btn-warning m-2" type="button" onclick="history.back()" name="volver atrás" value="Volver atrás"> -->
    </div>
    <div class="container">
        {% block body %}
         
        {% endblock %}
    </div>
    <footer>
        <div>
            <button id="goTopButton"></button>
        </div>
    </footer>
      
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function() {
            var goTopButton = $("#goTopButton");

            // Inicialmente oculta el botón
            goTopButton.hide();

            // Mostrar el botón cuando el usuario desplaza hacia abajo 200px
            $(window).scroll(function() {
                if ($(this).scrollTop() > 200) {
                    goTopButton.fadeIn(300); // Animación de desvanecimiento en 300ms
                } else {
                    goTopButton.fadeOut(300); // Animación de desvanecimiento en 300ms
                }
            });

            // Volver arriba cuando se hace clic en el botón
            goTopButton.click(function() {
                $("html, body").animate({ scrollTop: 0 }, "slow");
            });
        });


      // $(".selector").flatpickr(optional_config);

      flatpickr("input[type=datetime-local]", {
        enableTime: true,
        dateFormat: "Y-m-d H:i"
      });

      $(document).ready(function () {
          var dataTable = $('#tabla-incoming').DataTable({
                // scrollY: true,
                // scrollX: true,
              searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_incoming' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.e = '{{ query_inco }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "sn_batch_pk" },
                  { "data": "categoria_fk" },
                  { "data": "part_number" },
                  { "data": "descripcion"},
                  { "data": "qty" },
                  { "data": "f_vencimiento" },
                  { "data": "usuario" },
                  { "data": "saldo" },
                  
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var sn_batch_pk = data.sn_batch_pk;
                        var url = "/detalle_incoming/" + sn_batch_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-sn_batch_pk="' + sn_batch_pk + '">Detalles</a>';
                    }
                  }
              ]
          });
      });


      $(document).ready(function () {
          var dataTable = $('#tabla-comat').DataTable({
                // scrollY: true,
                // scrollX: true,
              searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_comat' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.c = '{{ query_comat }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "stdf_pk" },
                  { "data": "awb" },
                  { "data": "hawb" },
                  { "data": "num_manifiesto" },
                  { "data": "sum_cif" },
                  { "data": "bodega_fk" },
                  { "data": "usuario"},
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var stdf_pk = data.stdf_pk;
                        var url = "/detalle_comat/" + stdf_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-stdf_pk="' + stdf_pk + '">Ver Detalles</a>';
                    }
                  }
              ]
          });
      });


             

      $(document).ready(function() {
            $('#id_bodega_fk').select2({'placeholder':'Seleccione Bodega'});
            $('#id_origen_fk').select2({'placeholder':'Seleccione Origen'});
            $('#id_ubicacion_fk').select2({'placeholder':'Seleccione Ubicación'});
            $('#id_clasificacion_fk').select2({'placeholder':'Seleccione Clasificación'});
            $('#id_uom_fk').select2({'placeholder':'Seleccione UOM'});
            $('#id_condicion_fk').select2({'placeholder':'Seleccione Condición'});
            $('#id_ficha_fk').select2({'placeholder':'Seleccione N° de Ficha'});
            $('#id_stdf_fk').select2({'placeholder':'Seleccione STDF'});
            $('#id_incoming_fk').select2({'placeholder':'Seleccione Serial/Batch Number'});
            $('#id_owner_fk').select2({'placeholder':'Seleccione Owner'});
            $('#id_categoria_fk').select2({'placeholder':'Seleccione Categoria'});
          
        });

        $(document).ready(function () {
          var dataTable = $('#tabla-consumos').DataTable({
                // scrollY: true,
                // scrollX: true,
               searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_consumos' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.t = '{{ query_consu }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "consumo_pk" },
                  { "data": "incoming_fk" },
                  { "data": "f_transaccion" },
                  { "data": "matricula_aeronave" },
                  { "data": "orden_consumo" },
                  { "data": "qty_extraida" },
                  { "data": "usuario"},
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var consumo_pk = data.consumo_pk;
                        var url = "/detalle_consumos/" + consumo_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-consumo_pk="' + consumo_pk + '">Detalles</a>';
                    }
                  }
              ]
          });
        });
// // Test
//         $(document).ready(function () {
//             // Inicializa el elemento select2
//             $('#id_stdf_fk').select2({
//                 placeholder: 'Selecciona una opción',
//                 ajax: {
//                     url: '/obtener_stdf_incoming/', // La URL donde obtendrás los datos desde Django
//                     dataType: 'json',
//                     // delay: 250,
//                     data: function (params) {
//                         return {
//                             q: params.term // Enviar el término de búsqueda como parámetro de consulta
//                         };
//                     },
//                     processResults: function (data) {
//                         // Modifica la estructura de los resultados si es necesario
//                         const modifiedResults = data.stdf_data.map(item => {
//                             return {
//                                 id: item.stdf_pk,
//                                 text: item.stdf_pk,
//                             };
//                         });
//                         console.log('modifiedResults:', modifiedResults);

//                         return {
//                             results: modifiedResults
//                         };
//                     },
//                     cache: false,
//                     error: function (xhr, textStatus, errorThrown) {
//                         console.error('Error en la solicitud AJAX:', errorThrown);
//                     }
//                 }
//             });
//         });

        


        $(document).ready(function () {
            var dataTableIncoming = $('#tabla-inicio').DataTable({
                scrollY: true,
                scrollX: true,
                searching: false,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'buscar_datos_inicio' %}",
                    "type": "GET",
                    "data": function (d) {
                        d.n = '{{ query_inicio }}';
                    },
                    "dataSrc": "data_incoming"
                },
                "columns": [
                    // Define las columnas que deseas mostrar para Incoming
                    { "data": "sn_batch_pk" },
                    { "data": "categoria_fk__name_categoria" },
                    { "data": "part_number" },
                    { "data": "descripcion" },
                    { "data": "stdf_fk__stdf_pk" },
                    { "data": "qty" },
                    { "data": "qty_extraida_total" },
                    { "data": "saldo" },
                    { "data": "stdf_fk__awb" },
                    { "data": "stdf_fk__num_manifiesto" },
                    { "data": "owner_fk__name_owner"},
                    { "data": "ubicacion_fk__name_ubicacion" },
                    { "data": "f_vencimiento" },
                    {
                            "data": null,
                            "render": function (data, type, row, meta) {

                                var stdf_fk__stdf_pk = data.stdf_fk__stdf_pk;
                                var url = "/detalle_inicio/" + stdf_fk__stdf_pk + "/";
                                return '<a href="' + url + '" class="ver-detalles" data-stdf_fk__stdf_pk="' + stdf_fk__stdf_pk + '">Detalles</a>';
                            }
                        }
                ]

            });

            var dataTableComatsSinIncoming = $('#tabla-inicio-no-incomings').DataTable({
                searching: true,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'buscar_datos_inicio' %}",
                    "type": "GET",
                    "data": function (d) {
                        d.n = '{{ query_inicio }}';
                    },
                    "dataSrc": "data_comats_sin_incoming",
                    
                },
                "columns": [
                    // Define las columnas que deseas mostrar para Comats sin Incoming
                    { "data": "stdf_pk" },
                    { "data": "awb" },
                    { "data": "hawb" },
                    { "data": "prioridad" },

                ]
                

            });
        });











        
        // Configuración del DataTable secundario para comat_data
        $(document).ready(function () {
            var url = window.location.pathname;
            var stdf_pk = url.split('/').slice(-2, -1)[0];

            // Configuración del DataTable secundario para comat_data
            var incomingDataTable = $('#tabla-detalle-incoming').DataTable({
                searching: true,
                searchParams: ["search"],
                responsive: true,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'detalle_inicio' 0 %}".replace(0, stdf_pk),
                    "type": "GET",
                    "data": function (d) {
                        d.format = 'json';
                    },
                    "dataSrc": function (json) {
                        return json.incoming_data;
                    }
                },
                "columns": [
                            { "data": "sn_batch_pk", "width": "10%" },
                            { "data": "part_number", "width": "10%" },
                            { "data": "f_incoming", "width": "10%" },
                            { "data": "descripcion", "width": "10%" },
                            { "data": "po", "width": "10%" },
                            { "data": "qty", "width": "10%" },
                            { "data": "u_purchase_cost", "width": "10%" },
                            { "data": "total_u_purchase_cost", "width": "10%" },
                            { "data": "f_vencimiento", "width": "10%" },
                            { "data": "saldo", "width": "10%" },
                            { "data": "categoria_fk", "width": "10%" },
                            { "data": "clasificacion_fk", "width": "10%" },
                            { "data": "ubicacion_fk", "width": "10%" },
                            { "data": "uom_fk", "width": "10%" },
                            { "data": "owner_fk", "width": "10%" },
                            { "data": "condicion_fk", "width": "10%" },
                            { "data": "ficha_fk", "width": "10%" },
                            { "data": "observaciones", "width": "10%" },
                        ],
                        
            });

            // Configuración del DataTable secundario para consumos_data
            var consumosDataTable = $('#tabla-detalle-consumos').DataTable({
                searching: true,
                responsive: true,
                "processing": true,
                "serverSide": true,
                "ajax": {
                    "url": "{% url 'detalle_inicio' 0 %}".replace(0, stdf_pk),
                    "type": "GET",
                    "data": function (c) {
                        c.format = 'json';
                    },
                    "dataSrc": "consumos_data"
                },
                "columns": [
                            { "data": "incoming_fk", "width": "10%" },
                            { "data": "orden_consumo", "width": "10%" },
                            { "data": "f_transaccion", "width": "10%" },
                            { "data": "qty_extraida", "width": "10%" },
                            { "data": "matricula_aeronave", "width": "10%" },
                            { "data": "observaciones", "width": "10%" },
                        ],
                        
                        
            });

        
        
        });

        const ctx = document.getElementById('myChart');

        new Chart(ctx, {
            data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [
                {
                type: 'line',
                label: 'STDF',
                data: [12, 19, 3, 5, 2, 3],
                borderWidth: 1,

                backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 159, 64, 0.2)',
                'rgba(255, 205, 86, 0.2)',
                'rgba(75, 192, 192, 0.2)',
                'rgba(54, 162, 235, 0.2)',
                'rgba(153, 102, 255, 0.2)',
                'rgba(201, 203, 207, 0.2)'
                ],
                borderColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(153, 102, 255)',
                'rgb(201, 203, 207)'
                ],
                },
                {
                type: 'bar',
                label: 'Part Number',
                data: [10, 7, 1, 1, 4, 8],
                borderWidth: 1,
                backgroundColor: [
                'rgba(255, 99, 132, 0.6)',
                'rgba(255, 159, 64, 0.6)',
                'rgba(255, 205, 86, 0.6)',
                'rgba(75, 192, 192, 0.6)',
                'rgba(54, 162, 235, 0.6)',
                'rgba(153, 102, 255, 0.6)',
                'rgba(201, 203, 207, 0.6)'
                ],
                borderColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
                'rgb(255, 205, 86)',
                'rgb(75, 192, 192)',
                'rgb(54, 162, 235)',
                'rgb(153, 102, 255)',
                'rgb(201, 203, 207)'
                ],
            },
            ],
            },
            options: {
            scales: {
                y: {
                beginAtZero: true
                }
            }
            }
        });         
    
    </script>
  </body>
</html>