<!doctype html>
{% load static %}
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Inventario</title>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="{% static '/css/style.css' %}"/>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css"/>

    {% include 'navbar.html' %}
  </head>
  <body>
  
    <div class="container">
        {% block body %}
         
        {% endblock %}
      </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
      $(document).ready(function () {
          var dataTable = $('#tabla-incoming').DataTable({
              searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_incoming' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.e = '{{ query_inco }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "sn_batch_pk" },
                  { "data": "categoria_fk" },
                  { "data": "part_number" },
                  { "data": "qty" },
                  { "data": "f_vencimiento" },
                  { "data": "saldo" },
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var sn_batch_pk = data.sn_batch_pk;
                        var url = "/detalle_incoming/" + sn_batch_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-sn_batch_pk="' + sn_batch_pk + '">Detalles</a>';
                    }
                  }
              ]
          });
      });


      $(document).ready(function () {
          var dataTable = $('#tabla-comat').DataTable({
              searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_comat' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.c = '{{ query_comat }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "stdf_pk" },
                  { "data": "awb" },
                  { "data": "hawb" },
                  { "data": "num_manifiesto" },
                  { "data": "sum_cif" },
                  { "data": "bodega_fk" },
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var stdf_pk = data.stdf_pk;
                        var url = "/detalle_comat/" + stdf_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-stdf_pk="' + stdf_pk + '">Ver Detalles</a>';
                    }
                  }
              ]
          });
      });

      $(document).ready(function() {
            $('#id_bodega_fk').select2();
            $('#id_origen_fk').select2();
            $('#id_ubicacion_fk').select2();
            $('#id_clasificacion_fk').select2();
            $('#id_uom_fk').select2();
            $('#id_condicion_fk').select2();
            $('#id_ficha_fk').select2();
            // $('#id_stdf_fk').select2();
            $('#id_incoming_fk').select2();
          
        });

        $(document).ready(function () {
          var dataTable = $('#tabla-consumos').DataTable({
               searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'obtener_datos_consumos' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.t = '{{ query_consu }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "consumo_pk" },
                  { "data": "incoming_fk" },
                  { "data": "f_transaccion" },
                  { "data": "matricula_aeronave" },
                  { "data": "orden_consumo" },
                  { "data": "qty_extraida" },
                  { "data": "estado_fk" },
                  {
                    "data": null,
                    "render": function (data, type, row, meta) {
                        var consumo_pk = data.consumo_pk;
                        var url = "/detalle_consumos/" + consumo_pk + "/";
                        return '<a href="' + url + '" class="ver-detalles" data-consumo_pk="' + consumo_pk + '">Detalles</a>';
                    }
                  }
              ]
          });
        });
// Test
        $(document).ready(function () {
            // Inicializa el elemento select2
            $('#id_stdf_fk').select2({
                placeholder: 'Selecciona una opción',
                ajax: {
                    url: '/obtener_stdf_incoming/', // La URL donde obtendrás los datos desde Django
                    dataType: 'json',
                    // delay: 250,
                    data: function (params) {
                        return {
                            q: params.term // Enviar el término de búsqueda como parámetro de consulta
                        };
                    },
                    processResults: function (data) {
                        // Modifica la estructura de los resultados si es necesario
                        const modifiedResults = data.stdf_data.map(item => {
                            return {
                                id: item.stdf_pk,
                                text: item.stdf_pk,
                            };
                        });
                        console.log('modifiedResults:', modifiedResults);

                        return {
                            results: modifiedResults
                        };
                    },
                    cache: false,
                    error: function (xhr, textStatus, errorThrown) {
                        console.error('Error en la solicitud AJAX:', errorThrown);
                    }
                }
            });
        });

        $(document).ready(function () {
          var dataTable = $('#tabla-inicio').DataTable({
               searching: false,
              "processing": true,
              "serverSide": true,
              "ajax": {
                  "url": "{% url 'buscar_datos_inicio' %}",
                  "type": "GET", 
                  "data": function (d) {
                      d.n = '{{ query_inicio }}';}
                    
              },
              "columns": [
                  // Define las columnas que deseas mostrar
                  { "data": "sn_batch_pk" },
                  { "data": "categoria_fk__name_categoria" },
                  { "data": "part_number" },
                  { "data": "descripcion" },
                  { "data": "stdf_fk__stdf_pk" },
                  { "data": "qty" },
                  { "data": "qty_extraida_total" },
                  { "data": "saldo" },
                  { "data": "stdf_fk__awb" },
                  { "data": "stdf_fk__num_manifiesto" },
                  { "data": "owner_fk__name_owner"},
                  { "data": "ubicacion_fk__name_ubicacion" },
                  { "data": "f_vencimiento" },
                  
              ]
          });
        });

        // Función para mostrar la ventana emergente
        
    </script>

    
  </body>
</html>